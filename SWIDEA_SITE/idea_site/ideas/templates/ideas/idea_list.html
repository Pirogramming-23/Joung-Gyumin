{% extends 'ideas/base.html' %}
<meta name="csrf-token" content="{{ csrf_token }}">

{% block title %}ì•„ì´ë””ì–´ ë¦¬ìŠ¤íŠ¸{% endblock %}

{% block content %}
<h1>ğŸ’¡ ì•„ì´ë””ì–´ ë¦¬ìŠ¤íŠ¸</h1>

<p>
    <a href="{% url 'idea_create' %}">
        <button>â• ì•„ì´ë””ì–´ ë“±ë¡í•˜ê¸°</button>
    </a>
</p>

<form method="get">
    <select name="order" onchange="this.form.submit()">
        <option value="created_at" {% if order == 'created_at' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
        <option value="interest" {% if order == 'interest' %}selected{% endif %}>ê´€ì‹¬ë„ìˆœ</option>
        <option value="title" {% if order == 'title' %}selected{% endif %}>ì´ë¦„ìˆœ</option>
    </select>
</form>

<hr>

{% for idea in ideas %}
    <div>
        <img src="{{ idea.image.url }}" width="150">
        <h2>
            <a href="{% url 'idea_detail' idea.id %}">{{ idea.title }}</a>
            <span class="star star-icon" data-id="{{ idea.id }}">
                {% if idea.is_starred %}
                    ğŸŒŸ
                {% else %}
                    â­
                {% endif %}
            </span>
        </h2>
        <p>{{ idea.content|truncatewords:20 }}</p>
        <p>ê´€ì‹¬ë„: {{ idea.interest }}</p>
    </div>
    <hr>
{% empty %}
    <p>ë“±ë¡ëœ ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endfor %}

<script>
document.addEventListener("DOMContentLoaded", function () {
    const stars = document.querySelectorAll(".star-icon");

    stars.forEach(star => {
        star.addEventListener("click", function () {
            const ideaId = this.dataset.id;
            fetch(`/ideas/${ideaId}/toggle_star/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                },
            })
            .then(response => response.json())
            .then(data => {
                this.textContent = data.is_starred ? "ğŸŒŸ" : "â­";
            });
        });
    });
});
</script>

{% endblock %}
